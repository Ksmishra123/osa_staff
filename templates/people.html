{% extends 'base.html' %}
{% block content %}
<h1>People (Admin)</h1>

<form method="get" action="{{ url_for('admin_people') }}" class="card" style="margin-bottom:12px; display:flex; gap:8px; align-items:center;">
  <input type="text" name="q" placeholder="Search name, email, phone, airport…" value="{{ q or '' }}" style="flex:1;">
  <button type="submit">Search</button>
  {% if q %}
    <a href="{{ url_for('admin_people') }}">Clear</a>
  {% endif %}
  <a href="{{ url_for('admin_new_person') }}" style="margin-left:auto;"><button type="button">+ New Person</button></a>
</form>

<form method="post" action="{{ url_for('admin_bulk_delete_people_v2', q=q) }}"
      onsubmit="return confirm('Delete selected people? This cannot be undone.');">

  <div style="margin-bottom:8px; display:flex; gap:8px; align-items:center;">
    <button class="btn btn-outline-danger btn-sm" type="submit">Delete Selected</button>
  </div>
     
  <table class="table table-sm">
    <thead>
      <tr>
        <th style="width:32px;">
          <input type="checkbox" id="checkall" onclick="toggleAll(this)">
        </th>
        <th>Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Preferred Airport</th>
        <th style="width:240px;">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for p in people %}
      <tr>
        <td><input type="checkbox" name="ids" value="{{ p.id }}"></td>
        <td>{{ p.name }}</td>
        <td>{{ p.email }}</td>
        <td>{{ p.phone or '—' }}</td>
        <td>{{ p.preferred_airport or '—' }}</td>
        <td>
          <a class="btn btn-sm btn-outline-primary"
             href="{{ url_for('admin_edit_person', pid=p.id) }}">Edit</a>
        </td>
        <form method="post"
              action="{{ url_for('admin_delete_person_v2', pid=p.id, q=q) }}"
              style="display:inline"
              onsubmit="return confirm('Delete {{ p.name }}? This cannot be undone.');">
          <button class="btn btn-sm btn-outline-danger" type="submit">Delete</button>
        </form>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</form>

<script>
function toggleAll(master){
  const boxes = document.querySelectorAll("input[name='ids']");
  boxes.forEach(b => b.checked = master.checked);
}
</script>

{% endblock %}
